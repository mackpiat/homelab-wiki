{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"T470 Edge Router Infrastructure","text":"<p>Welcome to the internal documentation wiki for the homelab edge environment.</p>"},{"location":"#overview","title":"Overview","text":"<p>This system serves as the primary gateway, DNS resolver, and active defense node for the network. It is built on a \"trust no one\" architecture.</p>"},{"location":"#core-services","title":"Core Services","text":"<ul> <li>Hardware: Lenovo ThinkPad T470 (Utilizing battery as built-in UPS)</li> <li>OS: Debian Linux</li> <li>Perimeter Defense: CrowdSec IDS/IPS (nftables bouncer)</li> <li>DNS Resolution: Unbound (Recursive caching) + AdGuard Home</li> <li>Overlay Network: Tailscale</li> </ul> <p>Documentation maintained via automated CI/CD pipeline.</p>"},{"location":"crowdsec/","title":"CrowdSec IDS/IPS Deployment","text":""},{"location":"crowdsec/#overview","title":"Overview","text":"<p>This document outlines the deployment and configuration of CrowdSec on the Debian router. CrowdSec acts as a collaborative Intrusion Detection System (IDS) and Intrusion Prevention System (IPS). It parses local system logs in real-time, cross-references suspicious behavior against a global threat intelligence network, and actively drops malicious packets at the network edge.</p>"},{"location":"crowdsec/#architecture","title":"Architecture","text":"<ul> <li>Core Engine - <code>crowdsec</code> (Responsible for log acquisition and parsing)</li> <li>Mitigation Bouncer - <code>crowdsec-firewall-bouncer-nftables</code> (Responsible for manipulating firewall rules)</li> <li>Telemetry - <code>cscli</code> (Command Line Interface for engine management)</li> </ul>"},{"location":"crowdsec/#installation","title":"Installation","text":"<p>The deployment requires two distinct components - the monitoring agent and the enforcement bouncer.</p> <ul> <li>Add the official CrowdSec repository to receive timely security patches directly from the maintainers, bypassing older Debian repos.</li> </ul> <pre><code>curl -s [https://install.crowdsec.net](https://install.crowdsec.net) | sudo bash\n</code></pre> <ul> <li>Install the core engine. By default, it runs as a daemon but does not actively block traffic yet.</li> </ul> <pre><code>sudo apt install crowdsec -y\n</code></pre> <ul> <li>Install the specific bouncer for our firewall backend. This binary reads the local API decisions from the CrowdSec engine and automatically creates 'drop' rules in the nftables chains.</li> </ul> <pre><code>sudo apt install crowdsec-firewall-bouncer-nftables -y\n</code></pre>"},{"location":"crowdsec/#threat-intelligence-sync","title":"Threat Intelligence Sync","text":"<ul> <li>To ensure the router defends against zero-day threats and currently active botnets, the local hub must be synchronized with the global database.</li> <li>'hub update' pulls the latest index of available parsers and global blocklists.</li> <li>'hub upgrade' applies them to the local engine, immediately shielding the router from tens of thousands of globally recognized malicious IPs.</li> </ul> <pre><code>sudo cscli hub update &amp;&amp; sudo cscli hub upgrade\n</code></pre>"},{"location":"crowdsec/#log-acquisition-parsing-the-systemd-fix","title":"Log Acquisition &amp; Parsing (The systemd Fix)","text":"<p>By default, modern Debian systems utilize journald for logging, rather than flat files in /var/log/. The engine required specific parsers to translate the systemd journal format into actionable threat intelligence.</p> <ul> <li>Install the baseline Linux collection, providing the dictionaries necessary to understand syslog and iptables/nftables drop logs.</li> </ul> <pre><code>sudo cscli collections install crowdsecurity/linux\n</code></pre> <ul> <li>Install the specific dictionaries required to parse OpenSSH daemon logs, allowing the engine to detect SSH brute-force and exploit attempts.</li> </ul> <pre><code>sudo cscli collections install crowdsecurity/sshd\n</code></pre> <p>Baseline Linux and sshd collection comes along with the package (Optional to run the above commands, incase the collections are not installed).</p> <ul> <li>The CrowdSec daemon loads parsers into memory at boot. Restarting the service forces it to apply the newly installed collections to the live journal stream.</li> </ul> <pre><code>sudo systemctl restart crowdsec\n</code></pre>"},{"location":"crowdsec/#operational-verification","title":"Operational Verification","text":"<ul> <li>View all IPs currently banned by the local firewall</li> </ul> <pre><code>sudo cscli decisions list\n</code></pre> <ul> <li>View the status of log parsing and acquisition (Verify 'Lines parsed' increments under Acquisition Metrics)</li> </ul> <pre><code>sudo cscli metrics\n</code></pre> <ul> <li>Tail the live CrowdSec engine logs via the systemd journal</li> </ul> <pre><code>sudo journalctl -u crowdsec -f\n</code></pre>"},{"location":"unbound/","title":"Unbound Recursive DNS Resolver","text":""},{"location":"unbound/#overview","title":"Overview","text":"<p>This document outlines the configuration of Unbound, deployed as a fully recursive, authoritative DNS resolver on the Debian router.</p> <p>By default, most networks forward DNS queries to upstream corporate providers (like Cloudflare's <code>1.1.1.1</code> or Google's <code>8.8.8.8</code>). This setup eliminates that dependency. When a client requests a domain, Unbound queries the 13 internet Root Servers directly, traverses to the Top Level Domain (TLD) servers, and finally to the authoritative nameservers.</p> <p>Result: Maximum privacy. No single third-party entity possesses a complete log of the network's DNS queries.</p>"},{"location":"unbound/#architecture-traffic-flow","title":"Architecture &amp; Traffic Flow","text":"<ol> <li>Client device requests a domain.</li> <li>The query is routed through the Tailscale tunnel to the AdGuard Home instance.</li> <li>AdGuard filters the request against known ad/tracker blocklists.</li> <li>If permitted, AdGuard forwards the request locally to Unbound (<code>127.0.0.1:5335</code>).</li> <li>Unbound performs the recursive resolution and caches the result for future identical queries.</li> </ol>"},{"location":"unbound/#installation-root-hints","title":"Installation &amp; Root Hints","text":"<p>First, we install the service and download the <code>root.hints</code> file. This file acts as the ultimate map, telling Unbound the IP addresses of the 13 master DNS servers that govern the internet.</p> <ul> <li>Unbound is available directly in the main Debian repositories.</li> </ul> <pre><code>sudo apt install unbound -y\n</code></pre> <ul> <li>We must manually download the latest list of root servers from InterNIC. The '-O' flag directs wget to overwrite the existing, potentially outdated <code>root.hints</code> file that comes with the default installation.</li> </ul> <pre><code>wget [https://www.internic.net/domain/named.cache](https://www.internic.net/domain/named.cache) -qO /var/lib/unbound/root.hints\n</code></pre>"},{"location":"unbound/#core-configuration","title":"Core Configuration","text":"<p>The primary configuration is written to a dedicated file to avoid modifying the base Unbound template. This ensures updates to the package do not overwrite our custom routing logic.</p> <ul> <li>Create and edit the custom configuration file</li> </ul> <pre><code>sudo vim /etc/unbound/unbound.conf.d/homelab.conf\n</code></pre>"},{"location":"unbound/#configuration-paylod","title":"Configuration Paylod","text":"<pre><code>server:\n    # Increase the verbosity (L1) for troubleshooting.\n    verbosity: 1\n\n    # Point Unbound to the map of the internet thats downloaded\n    root-hints: \"/var/lib/unbount/root.hints\"\n\n    # AdGuard Home must operate on standard port 53 to intercept client network requests.\n    # Therefore, Unbound is shifted to port 5335 to prevent a bind-address conflict.\n    port: 5335\n\n    # Unbound should only accept queries forwarded by the local AdGuard instance.\n    # Listening strictly on the loopback interface prevents the service from being\n    # weaponized in a DNS amplification attack from the open internet.\n    interface: 127.0.0.1\n\n    # Limits the service to IPv4 only. Disabling IPv6 prevents unnecessary\n    # external queries and potential DNS leaks, as the internal homelab does not utilize IPv6.\n    do-ip4: yes\n    do-udp: yes\n    do-tcp: yes\n    do-ip6: no\n\n    # Enables DNSSEC validation. This ensures the DNS records received from\n    # the root servers have not been cryptographically tampered with or hijacked in transit.\n    harden-dnssec-stripped: yes\n\n    # QNAME Minimisation is strictly for privacy. If a client asks for 'app.example.com',\n    # Unbound only asks the root server where '.com' is, not the full string.\n    # It minimizes metadata leaked to higher-level hierarchy servers.\n    qname-minimisation: yes\n\n    # Prevents DNS rebinding attacks. It ensures that malicious upstream servers\n    # cannot return private, local IP addresses in their responses to hijack local routing.\n    private-address: 192.168.0.0/16\n    private-address: 169.254.0.0/16\n    private-address: 172.16.0.0/12\n    private-address: 10.0.0.0/8\n    private-address: fd00::/8\n    private-address: fe80::/10\n\n    # Caching optimization to serve expired cache entries immediately to the user while\n    # unbound fetches the updated record in the background making the browsing feel instantly responsive.\n    serve-expired: yes\n\n    # Pre-fetching popular records before they expire from the cache.\n    prefetch: yes\n</code></pre>"},{"location":"unbound/#service-initialization","title":"Service Initialization","text":"<p>With the configuration written, the service is enabled to start on boot and restarted to apply the new parameters.</p> <ul> <li>'enable --now' is a systemd shortcut that both enables the service to run at boot and starts it immediately in the current session.</li> </ul> <pre><code>sudo systemctl enable --now unbound\n</code></pre> <ul> <li>Verify the service is running smoothly and actively listening on port 5335.</li> </ul> <pre><code>sudo systemctl status unbound\n</code></pre>"},{"location":"unbound/#adguard-integration","title":"AdGuard Integration","text":"<p>The final step bridges the two services. In the AdGuard Home web dashboard <code>(Settings -&gt; DNS Settings)</code>, the Upstream DNS servers field is cleared of all external providers (e.g., Cloudflare, Google) and replaced exclusively with, <code>127.0.0.1:5335</code>.</p>"}]}